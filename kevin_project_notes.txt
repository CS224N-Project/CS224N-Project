
==== AZURE VMs ====

Azure VM 1 - TensorFlow
Machine: rational-tf
User: neuron
ssh neuron@157.55.141.160
Password: J7O6TJ0MgdN0
Once you are done working, stop your VM!

Azure VM 1 - Theano
Machine: rational-theano
User: neuron
ssh neuron@65.52.234.33
Password: J7O6TJ0MgdN0
Once you are done working, stop your VM!


==== TASKS ====

_ implement tensorflow version in exact same/similar structure as theano (i.e. use their code framework exactly), then rearchitect (keep it simple and reproduce results as closely as possible)


==== INSTALLATION AND INITIAL RUN ====

https://github.com/taolei87/rcnn/tree/master/code/rationale

Commands that I ran...

pip install Theano

export PYTHONPATH=/Users/stanford/Desktop/Winter2017/CS224n/FinalProject/rcnn-master_tf/code
export PYTHONPATH=/Users/stanford/Desktop/Winter2017/CS224n/FinalProject/rcnn-master_theano/code

if GPU...
export THEANO_FLAGS='device=gpu,floatX=float32'

if no GPU...
export THEANO_FLAGS='device=cpu,floatX=float32'

Note: must run exports above (environment variable sets) with each new shell session, or else add to ~/.bash_profile (a unix shell script to execute at startup)

To see current environment variables:
printenv | more

python rationale.py --embedding /Users/stanford/Desktop/Winter2017/CS224n/FinalProject/beer/review+wiki.filtered.200.txt.gz --train /Users/stanford/Desktop/Winter2017/CS224n/FinalProject/beer/reviews.aspect1.train.txt.gz --dev /Users/stanford/Desktop/Winter2017/CS224n/FinalProject/beer/reviews.aspect1.heldout.txt.gz --load_rationale /Users/stanford/Desktop/Winter2017/CS224n/FinalProject/beer/annotations.json --aspect 0 --dump outputs.json --sparsity 0.0003 --coherent 2.0

python rationale.py                             # independent selection version
      --embedding /path/to/vectors              # path to load word vectors (required)
      --train reviews.aspect0.train.txt.gz      # path to training set (required)
      --dev reviews.aspect0.heldout.txt.gz      # path to development set (required)        
      --load_rationale annotations.json         # path to rationale annotation for testing (required)
      --aspect 0                                # which aspect (-1 means all aspects)
      --dump outputs.json                       # dump selected rationales and predictions
      --sparsity 0.0003 --coherent 2.0          # regularizations      



==== GENERATING SMALLER DATA SETS FOR FAST RUNS AND BASIC TESTING ====


python select_modified.py 1 /Users/stanford/Desktop/Winter2017/CS224n/FinalProject/beer/reviews.aspect1.heldout.txt.gz /Users/stanford/Desktop/Winter2017/CS224n/FinalProject/beer/reviews.aspect1.small

--- select.py requires sklearn, scipy etc. to be installed
--- created select_modified.py to modify some parameters
--- to run select_modified.py had to move select.py out of the directory! actually, renaming to select_.py also worked
--- first integer argument above is “aspect” and looks like 1,2,3 are valid as indicated by the sample train/heldout files provide… “aspect” specifies the element from the returned correlation coefficient matrix: https://docs.scipy.org/doc/numpy/reference/generated/numpy.corrcoef.html

python rationale.py --embedding /Users/stanford/Desktop/Winter2017/CS224n/FinalProject/beer/review+wiki.filtered.200.txt.gz --train /Users/stanford/Desktop/Winter2017/CS224n/FinalProject/beer/reviews.aspect1.small.train.txt.gz --dev /Users/stanford/Desktop/Winter2017/CS224n/FinalProject/beer/reviews.aspect1.small.heldout.txt.gz --load_rationale /Users/stanford/Desktop/Winter2017/CS224n/FinalProject/beer/annotations.json --aspect 0 --dump outputs.json --sparsity 0.0003 --coherent 2.0 --max_epochs 1 --hidden_dimension 20 --hidden_dimension2 3

--- with '.small' train / holdout files and additional parameters (--max_epochs 1 --hidden_dimension 20 --hidden_dimension2 3) a full run takes <3mins

--- example multi-line review entry from Beeradvocate.txt (raw data to be re-processed for further variety in testing):

beer/name: Sausa Weizen
beer/beerId: 47986
beer/brewerId: 10325
beer/ABV: 5.00
beer/style: Hefeweizen
review/appearance: 2.5
review/aroma: 2
review/palate: 1.5
review/taste: 1.5
review/overall: 1.5
review/time: 1234817823
review/profileName: stcules
review/text: A lot of foam. But a lot.  In the smell some banana, and then lactic and tart. Not a good start.   Quite dark orange in color, with a lively carbonation (now visible, under the foam).    Again tending to lactic sourness.       Same for the taste. With some yeast and banana.


==== AZURE COMMANDS ====

First:
sudo apt-get install nvidia-current nvidia-settings
sudo nvidia-xconfig
sudo reboot

Alternatively:
http://askubuntu.com/questions/481414/install-nvidia-driver-instead-nouveau

Then:
https://docs.google.com/document/d/1RhrTHOplbb_iTpOBE1luIESW2197xbaX8zw2lsifCow/edit#

<record additional steps here>

sudo apt <installed nvcc compiler>


export THEANO_FLAGS='floatX=float32,device=gpu,nvcc.flags=-D_FORCE_INLINES'
export THEANO_FLAGS='floatX=float32,device=gpu0,nvcc.flags=-D_FORCE_INLINES'
export THEANO_FLAGS='floatX=float32,device=cuda0,nvcc.flags=-D_FORCE_INLINES'

export PYTHONPATH=/home/neuron/rcnn-master_copy/code



nvidia-smi

python rationale.py --embedding /home/neuron/beer/review+wiki.filtered.200.txt.gz --train /home/neuron/beer/reviews.aspect1.train.txt.gz --dev /home/neuron/beer/reviews.aspect1.heldout.txt.gz --load_rationale /home/neuron/beer/annotations.json --aspect 0 --dump outputs.json --sparsity 0.0003 --coherent 2.0


==== AZURE THEANO INSTALL ===

Did this first:
http://askubuntu.com/questions/481414/install-nvidia-driver-instead-nouveau

Following these instructions:
http://deeplearning.net/software/theano_versions/dev/install_ubuntu.html

https://conda.io/docs/install/quick.html
scp Miniconda2-latest-Linux-x86_64.sh neuron@65.52.234.33:
https://conda.io/docs/test-drive.html

https://developer.nvidia.com/cuda-downloads

FULL INSTRUCTIONS:
http://developer.download.nvidia.com/compute/cuda/8.0/secure/Prod2/docs/sidebar/CUDA_Installation_Guide_Linux.pdf

==== CRITICAL POST-INSTALLATION STEP ===
export PATH=/usr/local/cuda-8.0/bin${PATH:+:${PATH}}
==== CRITICAL POST-INSTALLATION STEP ===


sudo dpkg -i cuda-repo-<distro>_<version>_<architecture>.deb
sudo dpkg -i cuda-repo-8.0.61_375.26_linux.deb



